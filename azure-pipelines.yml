trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  artifactoryService: 'hts2-npm2'
  targetRepo: 'manu-npm-virtual'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '25.6.1'
  displayName: 'Install Node.js'

# 1. Standard Bash for shell operations (mkdir)
- script: |
    mkdir -p $(HOME)/.npm/_cacache
  displayName: 'Initialize npm cache'

# 2. Consolidated JFrog Task (No comments, only jf commands)
- task: JfrogCliV2@1
  inputs:
    jfrogPlatformConnection: $(artifactoryService)
    command: |
      jf npm-config --repo-resolve=$(targetRepo) --repo-deploy=$(targetRepo)
      jf npm install --build-name=$(Build.DefinitionName) --build-number=$(Build.BuildNumber)
      jf npm publish --build-name=$(Build.DefinitionName) --build-number=$(Build.BuildNumber)
  #jf rt build-publish $(Build.DefinitionName) $(Build.BuildNumber)
  displayName: 'JFrog CLI: Config, Install, and Publish'